"""–î–∏–∞–ª–æ–≥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
import logging
from aiogram_dialog import Dialog, Window, DialogManager, StartMode
from aiogram_dialog.widgets.text import Const, Format
from aiogram_dialog.widgets.kbd import Button, Column
from aiogram.types import CallbackQuery

from bot.dialogs.user.states import UserStart
from bot.database.database import async_session_maker
from bot.database.repositories import UserRepository

logger = logging.getLogger(__name__)


async def get_rules_data(dialog_manager: DialogManager, **kwargs):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª"""
    return {}


async def on_rules_accept(c: CallbackQuery, button: Button, manager: DialogManager):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –ø—Ä–∞–≤–∏–ª"""
    logger.info(f"[on_rules_accept] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {c.from_user.id} –ø—Ä–∏–Ω—è–ª –ø—Ä–∞–≤–∏–ª–∞")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –∏ –æ—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–Ω—è—Ç—ã
    async with async_session_maker() as session:
        user = await UserRepository.get_or_create(
            session,
            telegram_id=c.from_user.id,
            username=c.from_user.username,
            first_name=c.from_user.first_name
        )
        await UserRepository.accept_rules(session, user.telegram_id)
        logger.info(f"[on_rules_accept] –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–Ω—è—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.telegram_id}")
    
    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
    await manager.switch_to(UserStart.CONFIRMED)


async def get_confirmed_data(dialog_manager: DialogManager, **kwargs):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"""
    return {}


async def on_continue_to_welcome(c: CallbackQuery, button: Button, manager: DialogManager):
    """–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø–∏—Å—å–º—É"""
    logger.info(f"[on_continue_to_welcome] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {c.from_user.id} –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—é")
    await manager.switch_to(UserStart.WELCOME)


async def get_welcome_data(dialog_manager: DialogManager, **kwargs):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞"""
    return {}


async def on_view_profiles_by_photo(c: CallbackQuery, button: Button, manager: DialogManager):
    """–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∞–Ω–∫–µ—Ç –ø–æ —Ñ–æ—Ç–æ"""
    logger.info(f"[on_view_profiles_by_photo] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {c.from_user.id} –≤—ã–±—Ä–∞–ª –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ —Ñ–æ—Ç–æ")
    from bot.dialogs.user.states import UserProfiles
    await manager.start(UserProfiles.LIST, mode=StartMode.NORMAL)


async def on_view_profiles_by_games(c: CallbackQuery, button: Button, manager: DialogManager):
    """–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∞–Ω–∫–µ—Ç –ø–æ –∏–≥—Ä–∞–º"""
    logger.info(f"[on_view_profiles_by_games] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {c.from_user.id} –≤—ã–±—Ä–∞–ª –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ –∏–≥—Ä–∞–º")
    await manager.done()
    # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∫–µ—Ç –ø–æ –∏–≥—Ä–∞–º
    await c.answer("–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∫–µ—Ç –ø–æ –∏–≥—Ä–∞–º –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏")


async def on_open_cabinet(c: CallbackQuery, button: Button, manager: DialogManager):
    """–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"""
    logger.info(f"[on_open_cabinet] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {c.from_user.id} –æ—Ç–∫—Ä—ã–ª –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
    await manager.done()
    # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
    await c.answer("–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏")


start_dialog = Dialog(
    Window(
        Const(
            "<b>–ö–æ–Ω—Ç–µ–Ω—Ç/—É—Å–ª—É–≥–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –ª–∏—Ü —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç.</b>\n\n"
            "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—Ç–æ–±—ã –æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, —Å–æ–±–ª—é–¥–∞–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∞–≤–∏–ª:\n\n"
            "<b>1. –£–≤–∞–∂–µ–Ω–∏–µ:</b> –ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –ª—é–±—ã–µ —Ñ–æ—Ä–º—ã –ª–∏—á–Ω—ã—Ö –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π, —É–Ω–∏–∂–µ–Ω–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞, —É–≥—Ä–æ–∑—ã, –∫–ª–µ–≤–µ—Ç–∞ –∏ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è –ø–æ –ª—é–±–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É (–ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç, –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Ä–µ–ª–∏–≥–∏—è, –≤–∑–≥–ª—è–¥—ã, –≤–Ω–µ—à–Ω–æ—Å—Ç–∏).\n\n"
            "<b>2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</b> –°—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å, –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å, —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∏–ª–∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ –∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –æ–±–Ω–∞–∂–µ–Ω–Ω—ã–µ –≥–µ–Ω–∏—Ç–∞–ª–∏–∏ –∏–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–æ–≤—ã—Ö –∞–∫—Ç–æ–≤(–≤ —Ç–æ–º —á–∏—Å–ª–µ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö). –¢–∞–∫ –∂–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —É—á–∞—Å—Ç–∏–µ –≤–æ –≤—Å—Ç—Ä–µ—á–∞—Ö –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–≥–æ, –Ω–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—å—è–Ω–µ–Ω–∏—è –∏–ª–∏ –∏–Ω–æ–≥–æ —Ç–æ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è.\n\n"
            "<b>3. –û–±—â–µ–Ω–∏–µ:</b> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥—Ä—É–±–æ–π –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏, —è–≤–Ω—ã–µ –∏ –∑–∞–≤—É–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–µ–ø—Ä–∏—Å—Ç–æ–π–Ω—ã–µ –Ω–∞–º—ë–∫–∏, —Å–µ–∫—Å—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Ç–µ–∫—Å—Ç—ã, –≤—É–ª—å–≥–∞—Ä–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–π.\n\n"
            "<b>4. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</b> –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ª–∏—á–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, –∞–¥—Ä–µ—Å–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ –ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö –∏ —Ç.–¥.)\n\n"
            "–ù–∞—Ä—É—à–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –≤–µ–¥–µ—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –≤–∞—à–µ–π —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—é —Ç–µ–∫—É—â–∏—Ö –≤—Å—Ç—Ä–µ—á. –í —Å–ª—É—á–∞–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞.\n\n"
            "–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–ª–æ—â–∞–¥–∫–∏ –Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–ø—Ä–∞–≤—å—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ @Admin. –ö –æ–±—Ä–∞—â–µ–Ω–∏—é —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã: —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å–∏ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è.\n\n"
            "–í–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏."
        ),
        Column(
            Button(
                Const("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"),
                id="accept_rules",
                on_click=on_rules_accept,
            ),
        ),
        getter=get_rules_data,
        state=UserStart.RULES,
    ),
    
    Window(
        Const("‚úÖ –°–ø–∞—Å–∏–±–æ! –í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏."),
        Column(
            Button(
                Const("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"),
                id="continue",
                on_click=on_continue_to_welcome,
            ),
        ),
        getter=get_confirmed_data,
        state=UserStart.CONFIRMED,
    ),
    
    Window(
        Const(
            "üëã –ü—Ä–∏–≤–µ—Ç!\n"
            "–†–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ Xplay ‚Äî –º–µ—Å—Ç–µ, –≥–¥–µ –º–æ–∂–Ω–æ –ø–æ–∏–≥—Ä–∞—Ç—å, –ø–æ–æ–±—â–∞—Ç—å—Å—è, –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –ª—é–¥—å–º–∏ –∏ –Ω–µ –±—ã—Ç—å –æ–¥–Ω–æ–º—É üòä\n\n"
            "–í–æ—Ç –∫–∞–∫ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 3 —à–∞–≥–∞:\n\n"
            "1Ô∏è‚É£ –°–º–æ—Ç—Ä–∏ –∞–Ω–∫–µ—Ç—ã –¥–µ–≤—É—à–µ–∫\n"
            "2Ô∏è‚É£ –í—ã–±–∏—Ä–∞–π —Ç—É, —Å –∫–µ–º —Ö–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è\n"
            "3Ô∏è‚É£ –ë—Ä–æ–Ω–∏—Ä—É–π —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ –ø–æ–¥–∫–ª—é—á–∞–π—Å—è –∫ –≤—Å—Ç—Ä–µ—á–µ\n\n"
            "–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:"
        ),
        Column(
            Button(
                Const("üîç –°–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∫–µ—Ç—ã (–ø–æ —Ñ–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏—é)"),
                id="view_profiles_photo",
                on_click=on_view_profiles_by_photo,
            ),
            Button(
                Const("üîç –°–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∫–µ—Ç—ã (–ø–æ –∏–≥—Ä–∞–º)"),
                id="view_profiles_games",
                on_click=on_view_profiles_by_games,
            ),
            Button(
                Const("üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"),
                id="cabinet",
                on_click=on_open_cabinet,
            ),
        ),
        getter=get_welcome_data,
        state=UserStart.WELCOME,
    ),
)
